name: Build Godot Project
on:
    push:
        branches: [main]

env:
    GODOT_VERSION: "4.4.1"
permissions:
    contents: read
    actions: read
    checks: write
    pull-requests: write
jobs:
    export-windows:
        name: Windows Export
        runs-on: ubuntu-latest
        container:
            image: barichello/godot-ci:4.4.1
        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  lfs: true
            - name: Setup
              run: |
                  mkdir -v -p ~/.local/share/godot/export_templates/
                  mv /root/.local/share/godot/export_templates/${GODOT_VERSION}.stable ~/.local/share/godot/export_templates/${GODOT_VERSION}.stable
            - name: Windows Build
              run: |
                  mkdir -v -p build/windows
                  godot --headless --verbose --export-release "windows" build/windows/CannonDefense.exe
            - name: Upload Artifact
              uses: actions/upload-artifact@v4
              with:
                  name: windows
                  path: build/windows
